var mongodb = require('mongodb'),
	MongoClient = mongodb.MongoClient, db = {},
	credentials = require('db_cred').string;

function connect (callback){
	if(typeof callback !== 'function') callback = function (){console.dir(arguments)};
	MongoClient.connect(credentials, function (e,DB){
		if(e) throw e;
		var dbname = DB.databaseName;
		DB.collectionNames(function(e, items) {
			if(e){
				console.error(' MongoDB Connection Error:');
				callback(e);
			};
			var i, coll;
			for(i=0;i<items.length;i++){
				coll = items[i].name.replace(dbname+'.','');
				if(coll !== 'system.indexes') db[coll] = DB.collection(coll);
			};
			callback(null,db,DB);
		});
	});
};

connect.mongodb = mongodb;

module.exports = connect;